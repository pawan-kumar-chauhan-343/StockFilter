<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upstox Stock Screener</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      background-color: #0f172a;
      color: #e2e8f0;
    }

    /* Custom animation for the ticker tape */
    @keyframes ticker-scroll {
      0% {
        transform: translateX(100%);
      }

      100% {
        transform: translateX(-100%);
      }
    }

    .ticker-tape {
      white-space: nowrap;
      overflow: hidden;
      box-sizing: border-box;
      -webkit-mask-image: linear-gradient(90deg, transparent, #fff 20%, #fff 80%, transparent);
      mask-image: linear-gradient(90deg, transparent, #fff 20%, #fff 80%, transparent);
    }

    .ticker-tape div {
      display: inline-block;
      animation: ticker-scroll 25s linear infinite;
    }

    /* Custom styles for the table */
    /* Adjusted padding and font size for a more compact look */
    th,
    td {
      padding: 8px 12px;
      font-size: 0.875rem;
      /* text-sm */
      text-align: left;
      border-bottom: 1px solid #1e293b;
    }

    /* Darker background for odd rows for readability */
    tr:nth-child(odd) {
      background-color: #1e293b;
    }

    /* Responsive table */
    .table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* Modal specific styles */
    .modal {
      background-color: rgba(0, 0, 0, 0.7);
    }

    /* New styles for the 'Down from Top' column to make it red and bold */
    .down-from-top {
      color: #ef4444;
      /* Tailwind's red-500 */
      font-weight: 600;
      /* semibold */
    }

    /* Custom styles for the table header to make it different */
    .table-head-custom th {
      background-color: #2a3a5a;
      /* A darker blue for distinction */
      color: #94a3b8;
      /* A lighter grey for contrast */
      font-weight: 600;
      /* semibold */
    }
  </style>
</head>

<body class="antialiased flex flex-col min-h-screen bg-slate-950">
  <header class="bg-slate-800 shadow-xl p-2 md:p-4 sticky top-0 z-50">
    <div class="ticker-tape font-mono text-xs md:text-sm text-yellow-300">
      <div>
        <button id="donateBtn" class="mx-4 md:mx-6 hover:underline transition-all">
          <span class="text-orange-400">ðŸ’°</span> Donate via UPI
        </button>
        <a href="https://zerodha.com/open-account?c=XCK853" class="mx-4 md:mx-6 hover:underline transition-all">
          <img id="ZerodhaLogo" src="https://placehold.co/25x25/FC3E14/FFFFFF?text=K" alt="Zerodha Logo"
            class="w-4 h-4 md:w-5 md:h-5 rounded mr-1 inline-block">
          <span>
            Open Demat Account <b><i class="text-orange-600">Zerodha</i></b>
          </span>
        </a>
        <a href="https://join.dhan.co/?invite=MJXCH55865" class="mx-4 md:mx-6 hover:underline transition-all">
          <img id="dhanLogo" src="https://placehold.co/25x25/22c55e/FFFFFF?text=D" alt="Dhan Logo"
            class="w-4 h-4 md:w-5 md:h-5 rounded mr-1 inline-block">
          <span>
            Open Demat Account <b><i class="text-green-500">Dhan</i></b>
          </span>
        </a>
        <a href="https://upstox.onelink.me/0H1s/3SCVP2" class="mx-4 md:mx-6 hover:underline transition-all">
          <img id="upstoxLogo" src="https://placehold.co/25x25/a855f7/FFFFFF?text=U" alt="Upstox Logo"
            class="w-4 h-4 md:w-5 md:h-5 rounded mr-1 inline-block">
          <span>Open Demat Account <b><i class="text-fuchsia-500">Upstox</i></b> </span>
        </a>
      </div>
    </div>
  </header>

  <main id="main" class="flex-grow container mx-auto px-2 md:px-4 py-4 md:py-8">
    <div class="flex flex-col w-full md:w-auto">

      <button id="showStocksBtn"
        class="mt-4 md:mt-0 px-8 py-2 bg-slate-700 text-white rounded-xl font-semibold hover:bg-slate-600 transition-all duration-300 flex items-center justify-center gap-2 w-full md:w-64 shadow-md hover:shadow-lg transform hover:scale-105 text-sm">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
          <path
            d="M2 5a2 2 0 012-2h12a2 2 0 012 2v2a2 2 0 01-2 2H4a2 2 0 01-2-2V5zM4 9a2 2 0 00-2 2v6a2 2 0 002 2h12a2 2 0 002-2v-6a2 2 0 00-2-2H4z" />
        </svg>
        Show All Stocks
      </button>
    </div>
    <h1 class="text-3xl md:text-5xl font-extrabold text-center text-blue-400 mb-4 md:mb-6 drop-shadow-lg">
      Stock Screener
    </h1>

    <p class="text-sm md:text-lg text-center text-slate-400 mb-6 md:mb-8">
      Find potential investment opportunities with a custom stock filter.
    </p>

    <div
      class="bg-slate-800 rounded-2xl shadow-2xl p-4 md:p-6 mb-4 flex flex-col md:flex-row items-end justify-evenly gap-3 transition-all duration-300">
      <div class="flex flex-col w-full">
        <label for="down" class="text-xs font-medium mb-1 text-slate-400">Down % from Top:</label>
        <input type="number" id="down" value="20" min="0" max="100" step="1"
          class="bg-slate-700 text-white rounded-xl p-2 w-full md:w-28 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-sm">
      </div>
      <div class="flex flex-col w-full">
        <label for="sma" class="text-xs font-medium mb-1 text-slate-400">SMA Period:</label>
        <input type="number" id="sma" value="200" min="1" step="1"
          class="bg-slate-700 text-white rounded-xl p-2 w-full md:w-28 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-sm">
      </div>
      <div class="flex flex-col w-full md:w-auto">
        <label for="fetchBtn" class="text-sm font-medium mb-1 text-slate-400 opacity-0 select-none">Submit
          Button</label>
        <button id="fetchBtn"
          class="px-6 py-2 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-all duration-300 shadow-md hover:shadow-lg w-full md:w-auto transform hover:scale-105 text-sm">
          Submit
        </button>
      </div>
    </div>

    <div id="allStockName"
      class="hidden fixed inset-0 z-50 bg-slate-900 bg-opacity-95 p-6 overflow-y-auto transition-all duration-300">
      <div class="ticker-tape font-mono text-xs md:text-sm text-yellow-300 mb-4 md:mb-6">
        <div>
          <button id="donateBtnModal" class="mx-4 md:mx-6 hover:underline transition-all">
            <span class="text-orange-400">ðŸ’°</span> Donate via UPI
          </button>
          <a href="https://zerodha.com/open-account?c=XCK853" class="mx-4 md:mx-6 hover:underline transition-all">
            <img src="https://placehold.co/25x25/FC3E14/FFFFFF?text=K" alt="Zerodha Logo"
              class="w-4 h-4 md:w-5 md:h-5 rounded mr-1 inline-block">
            <span>Open Demat Account <b><i class="text-orange-600">Zerodha-Kite</i></b></span>
          </a>
          <a href="https://join.dhan.co/?invite=MJXCH55865" class="mx-4 md:mx-6 hover:underline transition-all">
            <img src="https://placehold.co/25x25/22c55e/FFFFFF?text=D" alt="Dhan Logo"
              class="w-4 h-4 md:w-5 md:h-5 rounded mr-1 inline-block">
            <span>Open Demat Account <b><i class="text-green-500">Dhan</i></b></span>
          </a>
          <a href="https://upstox.onelink.me/0H1s/3SCVP2" class="mx-4 md:mx-6 hover:underline transition-all">
            <img src="https://placehold.co/25x25/a855f7/FFFFFF?text=U" alt="Upstox Logo"
              class="w-4 h-4 md:w-5 md:h-5 rounded mr-1 inline-block">
            <span>Open Demat Account <b><i class="text-fuchsia-500">Upstox</i></b> </span>
          </a>
        </div>
      </div>
      <div class="flex justify-between items-center mb-4 md:mb-6">
        <h2 class="text-2xl md:text-3xl font-bold text-blue-400">All Available Stocks</h2>
        <button id="closeStocksBtn" class="text-white hover:text-red-500 transition-all">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <div id="stockListContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
      </div>
    </div>

    <div class="w-full text-center mb-6 md:mb-8">
      <p class="text-xs md:text-sm italic text-slate-400">
        <span class="font-bold text-red-400 mr-1">Disclaimer:</span> Data shown is for informational purposes
        only and
        does not constitute financial advice.
      </p>
    </div>

    <div class="table-container bg-slate-800 rounded-xl shadow-xl">
      <table id="table" class="w-full">
        <thead id="tableHead" class="text-slate-400 uppercase text-xs table-head-custom">
        </thead>
        <tbody id="tableBody" class="text-sm">
        </tbody>
      </table>
      <div id="noDataMessage" class="hidden p-4 text-center text-slate-400 italic text-sm">
        No stocks found matching the criteria.
      </div>
      <div id="loading" class="hidden p-4 text-center text-blue-400 animate-pulse text-sm">
        Fetching data... please wait.
      </div>
    </div>
  </main>

  <footer id="footer" class="text-center p-4 text-xs md:text-sm text-slate-500 mt-4 md:mt-8 border-t border-slate-700">
    <p><span class="font-bold text-red-400 mr-1">Disclaimer:</span> The following data is provided for informational
      and
      research purposes only. It represents historical and current stock price information and does not constitute
      financial advice or a recommendation to buy, sell, or hold any stock. Please consult with a licensed
      financial
      advisor before making investment decisions. The website owner is not responsible for any financial losses
      arising
      from the use of this information.</p>
  </footer>

  <div id="upiModal"
    class="hidden modal fixed inset-0 z-[100] flex items-center justify-center p-4 transition-opacity duration-300">
    <div
      class="bg-slate-800 rounded-2xl shadow-2xl p-6 md:p-8 w-full max-w-sm relative transform scale-95 opacity-0 transition-all duration-300">
      <button id="closeUpiModalBtn" class="absolute top-4 right-4 text-slate-400 hover:text-white transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
      <h3 class="text-xl md:text-2xl font-bold text-center text-blue-400 mb-4 md:mb-6">Scan to Donate</h3>
      <div class="text-center">
        <img id="upiQrCode" src="UPI.jpg" alt="UPI QR Code"
          class="rounded-lg shadow-lg mx-auto mb-4 w-48 h-48 md:w-auto md:h-auto">
        <p class="text-slate-400 text-xs md:text-sm">Thank you for your support!</p>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>
    const stockList =[["INE351F01018", "Jaiprakash Power Ventures", "JPPOWER"],
      ["INE528G01035", "Yes Bank", "YESBANK"],
      ["INE821I01022", "IRB Infrastructure Developers", "IRB"],
      ["INE0W2G01015", "Sagility India", "SAGILITY"],
      ["INE0FS801015", "Motherson Sumi Wiring", "MSUMI"],
      ["INE457A01014", "Bank of Maharashtra", "MAHABANK"],
      ["INE040H01021", "Suzlon Energy", "SUZLON"],
      ["INE092T01019", "IDFC First Bank", "IDFCFIRSTB"],
      ["INE548A01028", "HFCL", "HFCL"],
      ["INE584A01023", "NMDC", "NMDC"],
      ["INE995S01015", "Niva Bupa Health Insurance Company", "NIVABUPA"],
      ["INE848E01016", "NHPC", "NHPC"],
      ["INE002L01015", "SJVN", "SJVN"],
      ["INE0ONG01011", "NTPC Green Energy", "NTPCGREEN"],
      ["INE168A01041", "Jammu & Kashmir Bank", "J&KBANK"],
      ["INE423Y01016", "SBFC Finance", "SBFC"],
      ["INE775A01035", "Samvardhana Motherson International", "MOTHERSON"],
      ["INE095N01031", "NBCC", "NBCC"],
      ["INE160A01022", "Punjab National Bank", "PNB"],
      ["INE256A01028", "Zee Entertainment", "ZEEL"],
      ["INE476A01022", "Canara Bank", "CANBK"],
      ["INE084A01016", "Bank of India", "BANKINDIA"],
      ["INE192B01031", "Welspun Living", "WELSPUNLIV"],
      ["INE103A01014", "Mangalore Refinery & Petroleum", "MRPL"],
      ["INE114A01011", "Steel Authority of India", "SAIL"],
      ["INE692A01016", "Union Bank of India", "UNIONBANK"],
      ["INE208A01029", "Ashok Leyland", "ASHOKLEY"],
      ["INE148I01020", "Sammaan Capital", "SAMMAANCAP"],
      ["INE242A01010", "Indian Oil Corporation", "IOC"],
      ["INE022Q01020", "Indian Energy Exchange", "IEX"],
      ["INE066P01011", "Inox Wind", "INOXWIND"],
      ["INE01EA01019", "Vishal Mega Mart", "VMM"],
      ["INE517F01014", "Gujarat Pipavav Port", "GPPL"],
      ["INE202E01016", "IREDA", "IREDA"],
      ["INE545U01014", "Bandhan Bank", "BANDHANBNK"],
      ["INE486A01021", "CESC", "CESC"],
      ["INE081A01020", "Tata Steel", "TATASTEEL"],
      ["INE780C01023", "JM Financial", "JMFINANCIL"],
      ["INE970X01018", "Lemon Tree Hotels", "LEMONTREE"],
      ["INE872J01023", "Devyani International", "DEVYANI"],
      ["INE129A01019", "GAIL", "GAIL"],
      ["INE962Y01021", "Ircon International", "IRCON"],
      ["INE180C01042", "Capri Global Capital", "CGCL"],
      ["INE171A01029", "Federal Bank", "FEDERALBNK"],
      ["INE470Y01017", "The New India Assurance Company", "NIACL"],
      ["INE172A01027", "Castrol", "CASTROLIND"],
      ["INE634I01029", "KNR Constructions", "KNRCON"],
      ["INE510A01028", "Engineers India", "ENGINERSIN"],
      ["INE0DK501011", "Piramal Pharma", "PPLPHARMA"],
      ["INE139A01034", "NALCO", "NATIONALUM"],
      ["INE491A01021", "City Union Bank", "CUB"],
      ["INE324A01032", "Jindal SAW", "JINDALSAW"],
      ["INE203G01027", "Indraprastha Gas", "IGL"],
      ["INE183A01024", "Finolex Industries", "FINPIPE"],
      ["INE868B01028", "NCC", "NCC"],
      ["INE109A01011", "Shipping Corporation of India", "SCI"],
      ["INE031A01017", "HUDCO", "HUDCO"],
      ["INE213A01029", "Oil & Natural Gas Corporation", "ONGC"],
      ["INE257A01026", "Bharat Heavy Electricals", "BHEL"],
      ["INE498L01015", "L&T Finance", "LTF"],
      ["INE531A01024", "Kansai Nerolac Paints", "KANSINER"],
      ["INE028A01039", "Bank of Baroda", "BANKBARODA"],
      ["INE075A01022", "Wipro", "WIPRO"],
      ["INE699H01024", "AWL Agri Business", "AWL"],
      ["INE589A01014", "NLC India", "NLCINDIA"],
      ["INE177H01039", "Godawari Power & ISPAT", "GPIL"],
      ["INE00M201021", "Sterling & Wilson Renewable Energy", "SWSOLAR"],
      ["INE976G01028", "RBL Bank", "RBLBANK"],
      ["INE320J01015", "RITES", "RITES"],
      ["INE347G01014", "Petronet LNG", "PETRONET"],
      ["INE531E01026", "Hindustan Copper", "HINDCOPPER"],
      ["INE278Y01022", "Campus Activewear", "CAMPUS"],
      ["INE752E01010", "Power Grid Corporation of India", "POWERGRID"],
      ["INE522D01027", "Manappuram Finance", "MANAPPURAM"],
      ["INE674K01013", "Aditya Birla Capital", "ABCAPITAL"],
      ["INE774D01024", "M&M Financial Services", "M&MFIN"],
      ["INE622W01025", "ACME Solar Holdings", "ACMESOLAR"],
      ["INE891D01026", "Redington", "REDINGTON"],
      ["INE0J5401028", "Mamaearth", "HONASA"],
      ["INE195J01029", "PNC Infratech", "PNCINFRA"],
      ["INE299U01018", "Crompton Greaves", "CROMPTON"],
      ["INE246F01010", "Gujarat State Petronet", "GSPL"],
      ["INE758E01017", "Jio Financial Services", "JIOFIN"],
      ["INE806T01020", "Sapphire Foods", "SAPPHIRE"],
      ["INE668F01031", "Jyothy Laboratories", "JYOTHYLAB"],
      ["INE029A01011", "Bharat Petroleum", "BPCL"],
      ["INE852O01025", "Aptus Value Housing Finance", "APTUS"],
      ["INE880J01026", "JSW Infrastructure", "JSWINFRA"],
      ["INE758T01015", "Eternal", "ETERNAL"],
      ["INE733E01010", "NTPC", "NTPC"],
      ["INE209L01016", "Jupiter Wagons", "JWL"],
      ["INE03JT01014", "Go Digit General Insurance", "GODIGIT"],
      ["INE121J01017", "Indus Towers", "INDUSTOWER"],
      ["INE256C01024", "Triveni Enineering & Industries", "TRIVENI"],
      ["INE415G01027", "Rail Vikas Nigam", "RVNL"],
      ["INE481Y01014", "GIC of India", "GICRE"],
      ["INE153T01027", "BLS International Services", "BLS"],
      ["INE376G01013", "Biocon", "BIOCON"],
      ["INE0Q9301021", "International Gemmological Institute", "IGIL"],
      ["INE951I01027", "V-Guard Industries", "VGUARD"],
      ["INE573A01042", "JK Tyre & Industries", "JKTYRE"],
      ["INE684F01012", "Firstsource Solutions", "FSL"],
      ["INE836A01035", "Birlasoft", "BSOFT"],
      ["INE020B01018", "REC", "RECLTD"],
      ["INE074A01025", "Praj Industries", "PRAJIND"],
      ["INE230A01023", "EIH Hotels", "EIHOTEL"],
      ["INE769A01020", "Aarti Industries", "AARTIIND"],
      ["INE269A01021", "Sonata Software", "SONATSOFTW"],
      ["INE522F01014", "Coal India", "COALINDIA"],
      ["INE245A01021", "Tata Power", "TATAPOWER"],
      ["INE274J01014", "Oil India", "OIL"],
      ["INE263A01024", "Bharat Electronics", "BEL"],
      ["INE134E01011", "Power Finance Corporation", "PFC"],
      ["INE154A01025", "ITC", "ITC"],
      ["INE094A01015", "Hindustan Petroleum", "HINDPETRO"],
      ["INE602A01031", "PCBL Chemical", "PCBL"],
      ["INE302A01020", "Exide Industries", "EXIDEIND"],
      ["INE0I7C01011", "Latent View Analytics", "LATENTVIEW"],
      ["INE825A01020", "Vardhman Textiles", "VTL"],
      ["INE228A01035", "Usha Martin", "USHAMART"],
      ["INE844O01030", "Gujarat Gas", "GUJGASLTD"],
      ["INE073K01018", "Sona BLW Precision Forgings", "SONACOMS"],
      ["INE575P01011", "Star Health Insurance", "STARHEALTH"],
      ["INE267A01025", "Hindustan Zinc", "HINDZINC"],
      ["INE530B01024", "IIFL Finance", "IIFL"],
      ["INE205A01025", "Vedanta", "VEDL"],
      ["INE101I01011", "Afcons Infrastructure", "AFCONS"],
      ["INE019C01026", "Himadri Speciality Chemical", "HSCL"],
      ["INE818H01020", "LT Foods", "LTFOODS"],
      ["INE200M01039", "Varun Beverages", "VBL"],
      ["INE09XN01023", "Akums Drugs & Pharma", "AKUMS"],
      ["INE148O01028", "Delhivery", "DELHIVERY"],
      ["INE438A01022", "Apollo Tyres", "APOLLOTYRE"],
      ["INE743M01012", "RHI Magnesita", "RHIM"],
      ["INE665A01038", "Swan Corp", "SWANCORP"],
      ["INE979A01025", "Saregama India", "SAREGAMA"],
      ["INE511C01022", "Poonawalla Fincorp", "POONAWALLA"],
      ["INE285A01027", "Elgi Equipments", "ELGIEQUIP"],
      ["INE119A01028", "Balrampur Chini Mills", "BALRAMCHIN"],
      ["INE303R01014", "Kalyan Jewellers", "KALYANKJIL"],
      ["INE113A01013", "Gujarat Narmada Valley Fert & Chem", "GNFC"],
      ["INE545A01024", "HEG", "HEG"],
      ["INE463A01038", "Berger Paints", "BERGEPAINT"],
      ["INE763I01026", "Transformers & Rectifiers", "TARIL"],
      ["INE016A01026", "Dabur India", "DABUR"],
      ["INE152M01016", "Triveni Turbines", "TRITURBINE"],
      ["INE128S01021", "Five Star Business Finance", "FIVESTAR"],
      ["INE883F01010", "Aadhar Housing Finance", "AADHARHFC"],
      ["INE085A01013", "Chambal Fertilisers & Chemicals", "CHAMBLFERT"],
      ["INE121E01018", "JSW Energy", "JSWENERGY"],
      ["INE842C01021", "Minda Corporation", "MINDACORP"],
      ["INE111A01025", "Container Corporation of India", "CONCOR"],
      ["INE424H01027", "Sun TV Network", "SUNTV"],
      ["INE399G01023", "Ramkrishna Forgings", "RKFORGE"],
      ["INE371A01025", "Graphite", "GRAPHITE"],
      ["INE457L01029", "PG Electroplast", "PGEL"],
      ["INE385C01021", "Sarda Energy & Minerals", "SARDAEN"],
      ["INE548C01032", "Emami", "EMAMILTD"],
      ["INE419U01012", "Happiest Minds Technologies", "HAPPSTMNDS"],
      ["INE079A01024", "Ambuja Cements", "AMBUJACEM"],
      ["INE065X01017", "Indegene", "INDGN"],
      ["INE115A01026", "LIC Housing Finance", "LICHSGFIN"],
      ["INE258G01013", "Sumitomo Chemical", "SUMICHEM"],
      ["INE726G01019", "ICICI Prudential Life Insurance", "ICICIPRULI"],
      ["INE619A01035", "Patanjali Foods", "PATANJALI"],
      ["INE010J01012", "Tejas Networks", "TEJASNET"],
      ["INE205B01031", "Elecon Engineering Company", "ELECON"],
      ["INE797F01020", "Jubilant FoodWorks", "JUBLFOOD"],
      ["INE271B01025", "Maharashtra Seamless", "MAHSEAMLES"],
      ["INE721A01047", "Shriram Finance", "SHRIRAMFIN"],
      ["INE242C01024", "Anant Raj", "ANANTRAJ"],
      ["INE914M01019", "Aster DM Healthcare", "ASTERDM"],
      ["INE399L01023", "Adani Total Gas", "ATGL"],
      ["INE398R01022", "Syngene International", "SYNGENE"],
      ["INE0BY001018", "Jubilant Ingrevia", "JUBLINGREA"],
      ["INE628A01036", "UPL", "UPL"],
      ["INE562A01011", "Indian Bank", "INDIANB"],
      ["INE155A01022", "Tata Motors", "TATAMOTORS"],
      ["INE814H01011", "Adani Power", "ADANIPOWER"],
      ["INE825V01034", "Vedant Fashions", "MANYAVAR"],
      ["INE949L01017", "AU Small Finance Bank", "AUBANK"],
      ["INE196A01026", "Marico", "MARICO"],
      ["INE142M01025", "Tata Technologies", "TATATECH"],
      ["INE274F01020", "Westlife Foodworld", "WESTLIFE"],
      ["INE850D01014", "Godrej Agrovet", "GODREJAGRO"],
      ["INE335Y01020", "IRCTC", "IRCTC"],
      ["INE178A01016", "Chennai Petroleum Corporation", "CHENNPETRO"],
      ["INE038A01020", "Hindalco Industries", "HINDALCO"],
      ["INE095A01012", "Indusind Bank", "INDUSINDBK"],
      ["INE967H01025", "Krishna Institute of Medical Sciences", "KIMS"],
      ["INE477A01020", "Can Fin Homes", "CANFINHOME"],
      ["INE053A01029", "Indian Hotels Company", "INDHOTEL"],
      ["INE271C01023", "DLF", "DLF"],
      ["INE220G01021", "Jindal Stainless", "JSL"],
      ["INE067A01029", "CG Power & Industrial Solutions", "CGPOWER"],
      ["INE795G01014", "HDFC Life Insurance", "HDFCLIFE"],
      ["INE00E101023", "Bikaji Foods International", "BIKAJI"],
      ["INE208C01025", "Aegis Logistics", "AEGISLOG"],
      ["INE348B01021", "Century Plyboards", "CENTURYPLY"],
      ["INE404A01024", "Aditya Birla Sun Life AMC", "ABSLAMC"],
      ["INE0DYJ01015", "Syrma SGS", "SYRMA"],
      ["INE235A01022", "Finolex Cables", "FINCABLES"],
      ["INE298J01013", "Nippon Life India AMC", "NAM-INDIA"],
      ["INE599M01018", "Just Dial", "JUSTDIAL"],
      ["INE450U01017", "Route Mobile", "ROUTE"],
      ["INE520A01027", "Zensar Technologies", "ZENSARTECH"],
      ["INE062A01020", "State Bank of India", "SBIN"],
      ["INE389H01022", "KEC International", "KEC"],
      ["INE572E01012", "PNB Housing Finance", "PNBHOUSING"],
      ["INE018E01016", "SBI Cards", "SBICARD"],
      ["INE931S01010", "Adani Energy Solutions", "ADANIENSOL"],
      ["INE439A01020", "Asahi India Glass", "ASAHIINDIA"],
      ["INE987B01026", "Natco Pharma", "NATCOPHARM"],
      ["INE421D01022", "CCL Products", "CCL"],
      ["INE07Y701011", "Schneider Electric Infra", "POWERINDIA"],
      ["INE191B01025", "Welspun Corp", "WELCORP"],
      ["INE810G01011", "Shyam Metalics & Energy", "SHYAMMETL"],
      ["INE03QK01018", "Cohance Lifesciences", "COHANCE"],
      ["INE570L01029", "Sai Life Sciences", "SAILIFE"],
      ["INE619B01017", "Newgen Software Technologies", "NEWGEN"],
      ["INE947Q01028", "Laurus Labs", "LAURUSLABS"],
      ["INE791I01019", "Brigade Enterprises", "BRIGADE"],
      ["INE338I01027", "Motilal Oswal Financial Services", "MOTILALOFS"],
      ["INE980O01024", "Jyoti CNC Automation", "JYOTICNC"],
      ["INE061F01013", "Fortis Healthcare", "FORTIS"],
      ["INE615H01020", "Titagarh Rail Systems", "TITAGARH"],
      ["INE120A01034", "Carborundum Universal", "CARBORUNIV"],
      ["INE901L01018", "Alembic Pharmaceuticals", "APLLTD"],
      ["INE146L01010", "Kirloskar Oil Engines", "KIRLOSENG"],
      ["INE040A01034", "HDFC Bank", "HDFCBANK"],
      ["INE296A01032", "Bajaj Finance", "BAJFINANCE"],
      ["INE092A01019", "Tata Chemicals", "TATACHEM"],
      ["INE885A01032", "Amara Raja Energy & Mobility", "ARE&M"],
      ["INE427F01016", "Chalet Hotels", "CHALET"],
      ["INE364U01010", "Adani Green Energy", "ADANIGREEN"],
      ["INE010B01027", "Zydus Life Science", "ZYDUSLIFE"],
      ["INE387A01021", "Sundram Fasteners", "SUNDRMFAST"],
      ["INE749A01030", "Jindal Steel", "JINDALSTEL"],
      ["INE03Q201024", "Alivus Life Sciences", "ALIVUS"],
      ["INE331A01037", "Ramco Cements", "RAMCOCEM"],
      ["INE017A01032", "Great Eastern Shipping Company", "GESHIP"],
      ["INE043W01024", "Vijaya Diagnostic Centre", "VIJAYA"],
      ["INE306R01017", "Intellect Design Arena", "INTELLECT"],
      ["INE126A01031", "EID Parry", "EIDPARRY"],
      ["INE466L01038", "360 One WAM", "360ONE"],
      ["INE700A01033", "Jubilant Pharmova", "JUBLPHARMA"],
      ["INE903U01023", "Signatureglobal", "SIGNATURE"],
      ["INE406A01037", "Aurobindo Pharma", "AUROPHARMA"],
      ["INE140A01024", "Piramal Enterprises", "PEL"],
      ["INE019A01038", "JSW Steel", "JSWSTEEL"],
      ["INE192A01025", "Tata Consumer Products", "TATACONSUM"],
      ["INE930H01031", "KPR Mill", "KPRMILL"],
      ["INE238A01034", "Axis Bank", "AXISBANK"],
      ["INE138Y01010", "KFin Technologies", "KFINTECH"],
      ["INE731H01025", "Action Construction Equipment", "ACE"],
      ["INE027H01010", "Max Healthcare Institute", "MAXHEALTH"],
      ["INE233A01035", "Godrej Industries", "GODREJIND"],
      ["INE227W01023", "Clean Science & Technology", "CLEAN"],
      ["INE239A01024", "Nestle", "NESTLEIND"],
      ["INE217B01036", "Kajaria Ceramics", "KAJARIACER"],
      ["INE670K01029", "Lodha Developers", "LODHA"],
      ["INE616N01034", "INOX India", "INOXINDIA"],
      ["INE176A01028", "Bata", "BATAINDIA"],
      ["INE102D01028", "Godrej Consumer Products", "GODREJCP"],
      ["INE136B01020", "Cyient", "CYIENT"],
      ["INE499A01024", "DCM Shriram Consolidated", "DCMSHRIRAM"],
      ["INE777K01022", "RR Kabel", "RRKABEL"],
      ["INE813H01021", "Torrent Power", "TORNTPOWER"],
      ["INE481N01025", "Home First Finance Company", "HOMEFIRST"],
      ["INE220B01022", "Kalpataru Projects International", "KPIL"],
      ["INE02ID01020", "Raymond Lifestyle", "RAYMONDLSL"],
      ["INE465A01025", "Bharat Forge", "BHARATFORG"],
      ["INE04I401011", "KPIT Technologies", "KPITTECH"],
      ["INE405E01023", "UNO Minda", "UNOMINDA"],
      ["INE089A01031", "Dr Reddys Laboratories", "DRREDDY"],
      ["INE854D01024", "United Spirits", "UNITDSPR"],
      ["INE281B01032", "Lloyds Metals & Energy", "LLOYDSME"],
      ["INE716A01013", "Whirlpool", "WHIRLPOOL"],
      ["INE168P01015", "Emcure Pharmaceuticals", "EMCURE"],
      ["INE002S01010", "Mahanagar Gas", "MGL"],
      ["INE474Q01031", "Global Health", "MEDANTA"],
      ["INE094J01016", "UTI AMC", "UTIAMC"],
      ["INE741K01010", "Credit Access Grameen", "CREDITACC"],
      ["INE663F01032", "Info Edge", "NAUKRI"],
      ["INE090A01021", "ICICI Bank", "ICICIBANK"],
      ["INE002A01018", "Reliance Industries", "RELIANCE"],
      ["INE285K01026", "Techno Electric & Engineering", "TECHNOE"],
      ["INE961O01016", "Rainbow Childrens Medicare", "RAINBOW"],
      ["INE226A01021", "Voltas", "VOLTAS"],
      ["INE742F01042", "Adani Ports & SEZ", "ADANIPORTS"],
      ["INE571A01038", "IPCA Laboratories", "IPCALAB"],
      ["INE006I01046", "Astral", "ASTRAL"],
      ["INE501A01019", "Deepak Fertilisers & Petrochemicals", "DEEPAKFERT"],
      ["INE860A01027", "HCL Technologies", "HCLTECH"],
      ["INE009A01021", "Infosys", "INFY"],
      ["INE669C01036", "Tech Mahindra", "TECHM"],
      ["INE115Q01022", "Inventurus Knowledge Solutions", "IKS"],
      ["INE180A01020", "Max Financial Services", "MFSL"],
      ["INE059A01026", "Cipla", "CIPLA"],
      ["INE176B01034", "Havells", "HAVELLS"],
      ["INE121A01024", "Cholamandalam Investment", "CHOLAFIN"],
      ["INE671H01015", "Sobha", "SOBHA"],
      ["INE251B01027", "Zen Technologies", "ZENTEC"],
      ["INE811K01011", "Prestige Estates Projects", "PRESTIGE"],
      ["INE211B01039", "Phoenix Mills", "PHOENIXLTD"],
      ["INE673O01025", "TBO Tek", "TBOTEK"],
      ["INE171Z01026", "Bharat Dynamics", "BDL"],
      ["INE406M01024", "Eris Lifesciences", "ERIS"],
      ["INE0BV301023", "CE Info Systems", "MAPMYINDIA"],
      ["INE044A01036", "Sun Pharmaceutical", "SUNPHARMA"],
      ["INE024L01027", "Gravita India", "GRAVITA"],
      ["INE093I01010", "Oberoi Realty", "OBEROIRLTY"],
      ["INE216P01012", "Aavas Financiers", "AAVAS"],
      ["INE151A01013", "Tata Communications", "TATACOMM"],
      ["INE702C01027", "APL Apollo Tubes", "APLAPOLLO"],
      ["INE338H01029", "Concord Biotech", "CONCORDBIO"],
      ["INE572A01036", "J B Chemicals and Pharmaceuticals", "JBCHEPHARM"],
      ["INE343G01021", "Bharti Hexacom", "BHARTIHEXA"],
      ["INE410P01011", "Narayana Hrudayalaya", "NH"],
      ["INE591G01025", "Coforge", "COFORGE"],
      ["INE686F01025", "United Breweries", "UBL"],
      ["INE288B01029", "Deepak Nitrite", "DEEPAKNTR"],
      ["INE417T01026", "PB FinTech", "POLICYBZR"],
      ["INE123W01016", "SBI Life Insurance", "SBILIFE"],
      ["INE765G01017", "ICICI Lombard General Insurance", "ICICIGI"],
      ["INE012A01025", "ACC", "ACC"],
      ["INE055A01016", "Aditya Birla Real Estate", "ABREL"],
      ["INE704P01025", "Cochin Shipyard", "COCHINSHIP"],
      ["INE050A01025", "Bombay Burmah Trading", "BBTC"],
      ["INE397D01024", "Bharti Airtel", "BHARTIARTL"],
      ["INE472A01039", "Blue Star", "BLUESTARCO"],
      ["INE205C01021", "Poly Medicure", "POLYMED"],
      ["INE149A01033", "Cholamandalam Financial Holdings", "CHOLAHLDNG"],
      ["INE068V01023", "Gland Pharma", "GLAND"],
      ["INE237A01028", "Kotak Bank", "KOTAKBANK"],
      ["INE732A01036", "Kirloskar Brothers", "KIRLOSBROS"],
      ["INE326A01037", "Lupin", "LUPIN"],
      ["INE918I01026", "Bajaj Finserv", "BAJAJFINSV"],
      ["INE150B01039", "Alkyl Amines Chemicals", "ALKYLAMINE"],
      ["INE935A01035", "Glenmark Pharmaceuticals", "GLENMARK"],
      ["INE112L01020", "Metropolis Healthcare", "METROPOLIS"],
      ["INE00WC01027", "Affle 3i", "AFFLE"],
      ["INE484J01027", "Godrej Properties", "GODREJPROP"],
      ["INE169A01031", "Coromandel International", "COROMANDEL"],
      ["INE732I01013", "Angel One", "ANGELONE"],
      ["INE259A01022", "Colgate Palmolive", "COLPAL"],
      ["INE475E01026", "Caplin Point Laboratories", "CAPLIPOINT"],
      ["INE00R701025", "Dalmia Bharat", "DALBHARAT"],
      ["INE759A01021", "Mastek", "MASTEK"],
      ["INE933S01016", "IndiaMART InterMesh", "INDIAMART"],
      ["INE021A01026", "Asian Paints", "ASIANPAINT"],
      ["INE787D01026", "Balkrishna Industries", "BALKRISIND"],
      ["INE423A01024", "Adani Enterprises", "ADANIENT"],
      ["INE030A01027", "Hindustan Unilever", "HINDUNILVR"],
      ["INE382Z01011", "Garden Reach Shipbuilders", "GRSE"],
      ["INE321T01012", "DOMS Industries", "DOMS"],
      ["INE634S01028", "Mankind Pharma", "MANKIND"],
      ["INE159A01016", "GlaxoSmithKline Pharmaceuticals", "GLAXO"],
      ["INE0V6F01027", "Hyundai Motor India", "HYUNDAI"],
      ["INE0IX101010", "Data Patterns", "DATAPATTNS"],
      ["INE047A01021", "Grasim Industries", "GRASIM"],
      ["INE913H01037", "Endurance Technologies", "ENDURANCE"],
      ["INE414G01012", "Muthoot Finance", "MUTHOOTFIN"],
      ["INE647A01010", "SRF", "SRF"],
      ["INE249Z01020", "Mazagon Dock Shipbuilders", "MAZDOCK"],
      ["INE356A01018", "Mphasis", "MPHASIS"],
      ["INE463V01026", "Anand Rathi Wealth", "ANANDRATHI"],
      ["INE325A01013", "Timken", "TIMKEN"],
      ["INE318A01026", "Pidilite Industries", "PIDILITIND"],
      ["INE944F01028", "Radico Khaitan", "RADICO"],
      ["INE200A01026", "GE Vernova T&D", "GVT&D"],
      ["INE212H01026", "AIA Engineering", "AIAENG"],
      ["INE467B01029", "Tata Consultancy Services", "TCS"],
      ["INE0NT901020", "Netweb Technologies", "NETWEB"],
      ["INE152A01029", "Thermax", "THERMAX"],
      ["INE003A01024", "Siemens", "SIEMENS"],
      ["INE974X01010", "Tube Investment", "TIINDIA"],
      ["INE482A01020", "CEAT", "CEATLTD"],
      ["INE280A01028", "Titan", "TITAN"],
      ["INE600L01024", "Dr. Lal Path Labs", "LALPATHLAB"],
      ["INE260B01028", "Godfrey Phillips", "GODFRYPHLP"],
      ["INE377N01017", "Waaree Energies", "WAAREEENER"],
      ["INE494B01023", "TVS Motors", "TVSMOTOR"],
      ["INE101A01026", "Mahindra & Mahindra", "M&M"],
      ["INE685A01028", "Torrent Pharmaceuticals", "TORNTPHARM"],
      ["INE018A01030", "Larsen & Toubro", "LT"],
      ["INE042A01014", "Escorts Kubota", "ESCORTS"],
      ["INE603J01030", "PI Industries", "PIIND"],
      ["INE09N301011", "Gujarat Fluorochemicals", "FLUOROCHEM"],
      ["INE298A01020", "Cummins", "CUMMINSIND"],
      ["INE596I01012", "Computer Age Management Services", "CAMS"],
      ["INE513A01022", "Schaeffler India", "SCHAEFFLER"],
      ["INE878B01027", "KEI Industries", "KEI"],
      ["INE738I01010", "eClerx Services", "ECLERX"],
      ["INE010V01017", "L&T Technology Services", "LTTS"],
      ["INE258A01016", "BEML", "BEML"],
      ["INE195A01028", "Supreme Industries", "SUPREMEIND"],
      ["INE373A01013", "BASF", "BASF"],
      ["INE192R01011", "Avenue Supermarts DMart", "DMART"],
      ["INE048G01026", "Navin Fluorine International", "NAVINFLUOR"],
      ["INE640A01023", "SKF India", "SKFINDIA"],
      ["INE066F01020", "Hindustan Aeronautics", "HAL"],
      ["INE007A01025", "CRISIL", "CRISIL"],
      ["INE849A01020", "Trent", "TRENT"],
      ["INE182A01018", "Pfizer", "PFIZER"],
      ["INE462A01022", "Bayer Crop Science", "BAYERCROP"],
      ["INE158A01026", "Hero Motocorp", "HEROMOTOCO"],
      ["INE117A01022", "ABB", "ABB"],
      ["INE262H01021", "Persistent Systems", "PERSISTENT"],
      ["INE214T01019", "LTI Mindtree", "LTIM"],
      ["INE540L01014", "Alkem Laboratories", "ALKEM"],
      ["INE646L01027", "Interglobe Aviation", "INDIGO"],
      ["INE670A01012", "Tata Elxsi", "TATAELXSI"],
      ["INE233B01017", "Blue Dart Express", "BLUEDART"],
      ["INE127D01025", "HDFC AMC", "HDFCAMC"],
      ["INE216A01030", "Britannia Industries", "BRITANNIA"],
      ["INE361B01024", "Divis Laboratories", "DIVISLAB"],
      ["INE739E01017", "Cera Sanitaryware", "CERA"],
      ["INE473A01011", "Linde", "LINDEINDIA"],
      ["INE100A01010", "ATUL", "ATUL"],
      ["INE531F01015", "Nuvama Wealth Management", "NUVAMA"],
      ["INE00LO01017", "Craftsman Automation", "CRAFTSMAN"],
      ["INE823G01014", "JK Cement", "JKCEMENT"],
      ["INE066A01021", "Eicher Motors", "EICHERMOT"],
      ["INE918Z01012", "Kaynes Technology India", "KAYNES"],
      ["INE455K01017", "Polycab", "POLYCAB"],
      ["INE437A01024", "Apollo Hospitals", "APOLLOHOSP"],
      ["INE745G01035", "MCX", "MCX"],
      ["INE371P01015", "Amber Enterprises", "AMBER"],
      ["INE372A01015", "Apar Industries", "APARINDS"],
      ["INE203A01020", "AstraZeneca Pharma", "ASTRAZEN"],
      ["INE917I01010", "Bajaj Auto", "BAJAJ-AUTO"],
      ["INE881D01027", "Oracle Financial Services Software", "OFSS"]]

    // UI elements
    const allStockNameDiv = document.getElementById("allStockName");
    const showStocksBtn = document.getElementById("showStocksBtn");
    const closeStocksBtn = document.getElementById("closeStocksBtn");
    const stockListContainer = document.getElementById("stockListContainer");
    const fetchBtn = document.getElementById('fetchBtn');
    const tableBody = document.getElementById('tableBody');
    const tableHead = document.getElementById('tableHead');
    const loadingDiv = document.getElementById('loading');
    const noDataMessageDiv = document.getElementById('noDataMessage');
    const donateBtn = document.getElementById('donateBtn');
    const donateBtnModal = document.getElementById('donateBtnModal');
    const upiModal = document.getElementById('upiModal');
    const upiModalContent = upiModal.querySelector("div");
    const closeUpiModalBtn = document.getElementById('closeUpiModalBtn');

    // Populate the hidden stock list on page load
    function populateAllStocks() {
      stockListContainer.innerHTML = '';
      for (let stock of stockList) {
        const stockName = stock[2];
        const item = document.createElement("div");
        item.className = "bg-slate-700 text-slate-300 p-2 rounded-xl shadow-sm hover:bg-slate-600 transition-colors cursor-pointer text-sm";
        item.textContent = stockName;
        stockListContainer.appendChild(item);
      }
    }
    populateAllStocks();

    // Toggle the visibility of the all-stocks div
    function toggleAllStocks() {
      allStockNameDiv.classList.toggle('hidden');
    }

    showStocksBtn.addEventListener('click', toggleAllStocks);
    closeStocksBtn.addEventListener('click', toggleAllStocks);

    // UPI modal functionality
    function showUpiModal() {
      upiModal.classList.remove('hidden');
      setTimeout(() => {
        upiModalContent.classList.remove('scale-95', 'opacity-0');
      }, 10);
    }

    function hideUpiModal() {
      upiModalContent.classList.add('scale-95', 'opacity-0');
      setTimeout(() => {
        upiModal.classList.add('hidden');
      }, 300);
    }

    donateBtn.addEventListener('click', showUpiModal);
    donateBtnModal.addEventListener('click', showUpiModal);
    closeUpiModalBtn.addEventListener('click', hideUpiModal);

    // Close modal when clicking outside of it
    upiModal.addEventListener('click', (e) => {
      if (e.target === upiModal) {
        hideUpiModal();
      }
    });

    // Helper function for rate limiting API calls
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Gets the index of the first trading day of each year
    function getFirstTradingDayIndexes(candles) {
      const seenYears = new Set();
      const indexes = {};
      for (let i = candles.length - 1; i >= 0; i--) {
        const dateStr = candles[i][0];
        const year = new Date(dateStr).getFullYear();
        if (!seenYears.has(year)) {
          seenYears.add(year);
          indexes[year] = i;
        }
      }
      return indexes;
    }

    // Fetch data for a single stock
    async function fetchData(instrument_key, stock_symbol, down = 20, SMA_period = 200) {
      const todayDate = new Date().toISOString().split('T')[0];
      const urlIntra = `https://api.upstox.com/v3/historical-candle/intraday/${instrument_key}/days/1`;
      const urlHistory = `https://api.upstox.com/v3/historical-candle/${instrument_key}/days/1/${todayDate}/2020-01-01`;
      const headers = {
        'Accept': 'application/json'
      };

      try {
        const [responseHist, responseIntra] = await Promise.all([
          axios.get(urlHistory, {
            headers
          }),
          axios.get(urlIntra, {
            headers
          })
        ]);

        let candles = [
          ...responseIntra.data.data.candles,
          ...responseHist.data.data.candles
        ];

        let data = {};
        let yearIndex = getFirstTradingDayIndexes(candles);
        const lowPriceList = candles.map(candle => candle[3]);
        const highestPrice = Math.max(...candles.map(candle => candle[2]));
        const closing200 = candles.map(candle => candle[4]).slice(0, SMA_period);
        const SMA200 = closing200.reduce((acc, val) => acc + val, 0) / SMA_period;

        const todayLowPrice = candles[0][3];
        let percentageDown = (highestPrice - todayLowPrice) * 100 / highestPrice;

        if (percentageDown > down && todayLowPrice < SMA200) {
          Object.entries(yearIndex).forEach(([key, value]) => {
            data[`yearLowPrice${key}`] = Math.min(...lowPriceList.slice(0, value));
          });
          data['highestPrice'] = highestPrice;
          data['todayLowPrice'] = todayLowPrice;
          data['percentageDown'] = `${percentageDown.toFixed(2)}%`;
          data["instrument_key"] = instrument_key;
          data["stock_symbol"] = stock_symbol;
        }

        return data;

      } catch (error) {
        console.error(`Error fetching ${stock_symbol}:`, error.message);
        return {};
      }
    }

    // Main function to iterate through all stocks
    async function forEachStock(stockList, down, SMA_period) {
      const finalOutput = {};
      const BATCH_SIZE = 50;

      loadingDiv.classList.remove('hidden');
      tableBody.innerHTML = '';
      noDataMessageDiv.classList.add('hidden');

      for (let i = 0; i < stockList.length; i += BATCH_SIZE) {
        const batch = stockList.slice(i, i + BATCH_SIZE);
        const promises = batch.map(stock =>
          fetchData(stock[0], stock[1], down, SMA_period)
            .then(data => {
              if (Object.keys(data).length !== 0) {
                finalOutput[stock[1]] = data;
              }
            })
        );

        await Promise.all(promises);
        console.log(`âœ… Completed batch ${i / BATCH_SIZE + 1}`);
        await sleep(1000);
      }

      loadingDiv.classList.add('hidden');
      showDataInTable(finalOutput);
    }

    // Click handler for the fetch button
    document.getElementById('fetchBtn').addEventListener('click', () => {
      const down = parseFloat(document.getElementById('down').value);
      const sma = parseInt(document.getElementById('sma').value);

      // Set up table headers
      tableHead.innerHTML = `
                <tr>
                    <th class="rounded-tl-xl">Stock Symbol</th>
                    <th>Highest Price</th>
                    <th>Today's Low</th>
                    <th>% Down from High</th>
                    <th>Till 2025 Lowest</th>
                    <th>Till 2024 Lowest</th>
                    <th>Till 2023 Lowest</th>
                    <th>Till 2022 Lowest</th>
                    <th>Till 2021 Lowest</th>
                    <th class="rounded-tr-xl">Till 2020 Lowest</th>
                </tr>
            `;

      forEachStock(stockList, down, sma);
    });

    // Function to display the fetched data in the table
    function showDataInTable(data) {
      const stocksToShow = Object.values(data);
      if (stocksToShow.length === 0) {
        noDataMessageDiv.classList.remove('hidden');
        return;
      }

      for (let stock of stocksToShow) {
        const row = document.createElement("tr");
        row.innerHTML = `
                    <td>${stock.stock_symbol || '-'}</td>
                    <td>${stock.highestPrice ? stock.highestPrice.toFixed(2) : '-'}</td>
                    <td>${stock.todayLowPrice ? stock.todayLowPrice.toFixed(2) : '-'}</td>
                    <td class="down-from-top">${stock.percentageDown || '-'}</td>
                    <td>${stock.yearLowPrice2025 ? stock.yearLowPrice2025.toFixed(2) : '-'}</td>
                    <td>${stock.yearLowPrice2024 ? stock.yearLowPrice2024.toFixed(2) : '-'}</td>
                    <td>${stock.yearLowPrice2023 ? stock.yearLowPrice2023.toFixed(2) : '-'}</td>
                    <td>${stock.yearLowPrice2022 ? stock.yearLowPrice2022.toFixed(2) : '-'}</td>
                    <td>${stock.yearLowPrice2021 ? stock.yearLowPrice2021.toFixed(2) : '-'}</td>
                    <td>${stock.yearLowPrice2020 ? stock.yearLowPrice2020.toFixed(2) : '-'}</td>
                `;
        tableBody.appendChild(row);
      }
    }
  </script>
</body>


</html>
